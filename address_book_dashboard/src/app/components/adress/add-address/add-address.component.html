<!-- Modal -->

<app-loader *ngIf="IsSpinner"></app-loader>
<div *ngIf="!IsSpinner" class="modal fade" id="addAdressModal" tabindex="-1" aria-labelledby="addAdressModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content border-0 rounded-4 shadow-sm">
      <div class="modal-header d-flex justify-content-between bg-dark text-white">
        <h5 class="modal-title" id="addAdressModalLabel">
          {{ form.get('Id')?.value ? 'Edit Address' : 'Add Address' }}
        </h5>
        <button type="button" class="btn-close bg-light" aria-label="Close" (click)="cancel()"></button>
      </div>
      <div class="modal-body bg-dark text-white">
        <form [formGroup]="form" (ngSubmit)="save()">

          <!-- Full Name, Email, Mobile -->
          <div class="row mb-3 g-3">
            <div class="col-12 col-sm-6 col-md-4">
              <label for="fullName" class="form-label">Full Name *</label>
              <input type="text" class="form-control" id="fullName" formControlName="FullName"
                [class.is-invalid]="form.get('FullName')?.invalid && form.get('FullName')?.touched">
              <div *ngIf="form.get('FullName')?.invalid && form.get('FullName')?.touched" class="invalid-feedback">
                <div *ngIf="form.get('FullName')?.errors?.['required']">Full Name is required</div>
                <div *ngIf="form.get('FullName')?.errors?.['minlength']">Full Name must be at least 2 characters</div>
              </div>
            </div>

            <div class="col-12 col-sm-6 col-md-4">
              <label for="email" class="form-label">Email *</label>
              <input type="email" class="form-control" id="email" formControlName="Email"
                [class.is-invalid]="form.get('Email')?.invalid && form.get('Email')?.touched">
              <div *ngIf="form.get('Email')?.invalid && form.get('Email')?.touched" class="invalid-feedback">
                <div *ngIf="form.get('Email')?.errors?.['required']">Email is required</div>
                <div *ngIf="form.get('Email')?.errors?.['email']">Please enter a valid email address</div>
              </div>
            </div>

            <div class="col-12 col-sm-6 col-md-4">
              <label for="mobileNumber" class="form-label">Mobile Number *</label>
              <input type="tel" class="form-control" id="mobileNumber" formControlName="MobileNumber"
                [class.is-invalid]="form.get('MobileNumber')?.invalid && form.get('MobileNumber')?.touched">
              <div *ngIf="form.get('MobileNumber')?.invalid && form.get('MobileNumber')?.touched"
                class="invalid-feedback">
                <div *ngIf="form.get('MobileNumber')?.errors?.['required']">Mobile Number is required</div>
                <div *ngIf="form.get('MobileNumber')?.errors?.['pattern']">Please enter a valid mobile number</div>
              </div>
            </div>
          </div>

          <!-- Date of Birth, Job, Department -->
          <div class="row mb-3 g-3 align-items-center">
            <div class="col-12 col-sm-6 col-md-4">
              <mat-form-field class="w-100">
                <mat-label class="text-white">Choose a date</mat-label>
                <input matInput [matDatepicker]="picker" formControlName="DateOfBirth" placeholder="Choose a date"
                  class="form-control">
                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-datepicker #picker></mat-datepicker>
              </mat-form-field>
            </div>
<div class="col-12 col-sm-6 col-md-4">
  <label for="job" class="form-label">Job *</label>
  <div class="position-relative">
    <ng-select 
      [items]="jobs" 
      bindLabel="Name" 
      bindValue="Id" 
      placeholder="Select Job" 
      formControlName="JobId"
      [searchable]="true" 
      [clearable]="true" 
      (change)="onJobChange($event)">
    </ng-select>

    <!-- Selected job displayed inside container -->
    <p class="selected-value">{{selctedJob}}</p>
  </div>

  <div *ngIf="form.get('JobId')?.invalid && form.get('JobId')?.touched" class="invalid-feedback d-block">
    Job selection is required
  </div>
</div>

<div class="col-12 col-sm-6 col-md-4">
  <label for="department" class="form-label">Department *</label>
  <div class="position-relative">
    <ng-select 
      [items]="departments" 
      bindLabel="Name" 
      bindValue="Id" 
      placeholder="Select Department" 
      formControlName="DepartmentId"
      [searchable]="true" 
      [clearable]="true" 
      (change)="onDeptChange($event)">
    </ng-select>

    <!-- Selected department displayed inside container -->
    <p class="selected-value">{{selectedJDep}}</p>
  </div>

  <div *ngIf="form.get('DepartmentId')?.invalid && form.get('DepartmentId')?.touched"
    class="invalid-feedback">
    Department selection is required
  </div>
</div>

          </div>

          <!-- Address, Password, Photo -->
          <div class="row mb-3 g-3">
            <div class="col-12 col-sm-6 col-md-4">
              <label for="addressLine" class="form-label">Address Line *</label>
              <input class="form-control" id="addressLine" formControlName="AddressLine"
                [class.is-invalid]="form.get('AddressLine')?.invalid && form.get('AddressLine')?.touched">
              <div *ngIf="form.get('AddressLine')?.invalid && form.get('AddressLine')?.touched"
                class="invalid-feedback">
                <div *ngIf="form.get('AddressLine')?.errors?.['required']">Address Line is required</div>
                <div *ngIf="form.get('AddressLine')?.errors?.['minlength']">Address Line must be at least 5 characters
                </div>
              </div>
            </div>

            <div class="col-12 col-sm-6 col-md-4 position-relative password-container">
              <label for="password" class="form-label">Password *</label>
              <input [type]="showPassword ? 'text' : 'password'" id="password" formControlName="Password"
                class="form-control"
                [class.is-invalid]="form.get('Password')?.invalid && form.get('Password')?.touched">
              <i class="bi fw-bold fs-4 m-3 eye-icon" [ngClass]="showPassword ? 'bi-eye-slash' : 'bi-eye'"
                (click)="togglePassword()"></i>
              <div *ngIf="form.get('Password')?.invalid && form.get('Password')?.touched" class="invalid-feedback">
                <div *ngIf="form.get('Password')?.errors?.['required']">Password is required</div>
                <div *ngIf="form.get('Password')?.errors?.['minlength']">Password must be at least 6 characters</div>
              </div>
            </div>

            <div class="col-12 col-sm-6 col-md-4">
              <label for="photo" class="form-label">Photo *</label>
              <input type="file" class="form-control" id="photo" (change)="onFileSelected($event)"
                [class.is-invalid]="form.get('Photo')?.invalid && form.get('Photo')?.touched">
            </div>
          </div>

          <!-- Buttons -->
          <div class="d-flex flex-wrap justify-content-end gap-3 mt-4 pt-3 border-top">
            <button type="button" class="btn btn-secondary" (click)="cancel()">Cancel</button>
            <button type="submit" class="btn btn-info" [disabled]="form.invalid">Save</button>
          </div>

        </form>
      </div>
    </div>
  </div>
</div>